cmake_minimum_required(VERSION 3.16)

project(QtEnterpriseApp VERSION 2.0.0 LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# 查找Qt6组件
find_package(Qt6 REQUIRED COMPONENTS 
    Core 
    Widgets 
    Network 
    WebEngineWidgets 
    LinguistTools
    Concurrent
)

# 设置Qt6自动处理
set(CMAKE_AUTOMOC ON)
set(CMAKE_AUTORCC ON)
set(CMAKE_AUTOUIC ON)

# 企业级核心框架
set(CORE_SOURCES
    src/Core/Application.cpp
    src/Core/ServiceManager.cpp
    src/Core/DependencyContainer.cpp
)

set(CORE_HEADERS
    src/Core/Application.h
    src/Core/ServiceManager.h
    src/Core/DependencyContainer.h
)

# 接口定义
set(INTERFACE_HEADERS
    src/Interfaces/INetworkService.h
    src/Interfaces/IAuthenticationService.h
)

# 服务实现
set(SERVICE_SOURCES
    src/Services/NetworkService.cpp
    src/Services/AuthenticationService.cpp
    src/Services/AnalyticsService.cpp
)

set(SERVICE_HEADERS
    src/Services/NetworkService.h
    src/Services/AuthenticationService.h
    src/Services/AnalyticsService.h
)

# 本地化
set(LOCALIZATION_SOURCES
    src/Localization/LocalizationManager.cpp
)

set(LOCALIZATION_HEADERS
    src/Localization/LocalizationManager.h
)

# 翻译文件
set(TS_FILES
    src/Localization/translations/app_zh_CN.ts
    src/Localization/translations/app_en_US.ts
)

# 现有模块
set(EXISTING_SOURCES
    main.cpp
    mainuiwindow.cpp
    loginpage/loginpage.cpp
    userinfo/userinfopage.cpp
    changepasswordpage/changepasswordpage.cpp
    reportstab/reportstab.cpp
    userprofiletab/userprofiletab.cpp
    echarts/echartstab.cpp
    analytics/analytics.cpp
    styles/theme_manager.cpp
    utils/utils.cpp
)

set(EXISTING_HEADERS
    mainuiwindow.h
    loginpage/loginpage.h
    userinfo/userinfopage.h
    changepasswordpage/changepasswordpage.h
    reportstab/reportstab.h
    userprofiletab/userprofiletab.h
    echarts/echartstab.h
    analytics/analytics.h
    styles/theme_manager.h
    utils/utils.h
    common.h
)

# UI文件
set(UI_FILES
    mainuiwindow.ui
)

# 资源文件
set(RESOURCE_FILES
    layoutexamplestab.qrc
)

# 创建可执行文件
qt_add_executable(QtEnterpriseApp
    ${CORE_SOURCES}
    ${CORE_HEADERS}
    ${INTERFACE_HEADERS}
    ${SERVICE_SOURCES}
    ${SERVICE_HEADERS}
    ${LOCALIZATION_SOURCES}
    ${LOCALIZATION_HEADERS}
    ${EXISTING_SOURCES}
    ${EXISTING_HEADERS}
    ${UI_FILES}
    ${RESOURCE_FILES}
)

# 添加翻译支持
qt_add_translations(QtEnterpriseApp TS_FILES ${TS_FILES})

# 链接Qt6库
target_link_libraries(QtEnterpriseApp
    Qt6::Core
    Qt6::Widgets
    Qt6::Network
    Qt6::WebEngineWidgets
    Qt6::Concurrent
)

# 设置包含目录
target_include_directories(QtEnterpriseApp PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CMAKE_CURRENT_SOURCE_DIR}/src
    ${CMAKE_CURRENT_SOURCE_DIR}/src/Core
    ${CMAKE_CURRENT_SOURCE_DIR}/src/Interfaces
    ${CMAKE_CURRENT_SOURCE_DIR}/src/Services
    ${CMAKE_CURRENT_SOURCE_DIR}/src/Localization
)

# 编译器特定设置
if(WIN32)
    set_target_properties(QtEnterpriseApp PROPERTIES
        WIN32_EXECUTABLE TRUE
    )
endif()

if(APPLE)
    set_target_properties(QtEnterpriseApp PROPERTIES
        MACOSX_BUNDLE TRUE
        MACOSX_BUNDLE_INFO_PLIST ${CMAKE_CURRENT_SOURCE_DIR}/Info.plist.in
    )
endif()

# 安装规则
install(TARGETS QtEnterpriseApp
    BUNDLE DESTINATION .
    RUNTIME DESTINATION bin
)

# 复制翻译文件到输出目录
if(EXISTS "${CMAKE_CURRENT_BINARY_DIR}/translations")
    install(DIRECTORY "${CMAKE_CURRENT_BINARY_DIR}/translations"
        DESTINATION bin
    )
endif()

# 开发模式下的调试信息
if(CMAKE_BUILD_TYPE STREQUAL "Debug")
    target_compile_definitions(QtEnterpriseApp PRIVATE DEBUG_MODE)
endif()

# 企业级特性宏定义
target_compile_definitions(QtEnterpriseApp PRIVATE
    ENTERPRISE_EDITION
    APP_VERSION="${PROJECT_VERSION}"
    QT_DEPRECATED_WARNINGS
)

message(STATUS "Qt Enterprise App Configuration:")
message(STATUS "  Version: ${PROJECT_VERSION}")
message(STATUS "  Build Type: ${CMAKE_BUILD_TYPE}")
message(STATUS "  Qt Version: ${Qt6_VERSION}")
message(STATUS "  Enterprise Features: Enabled")