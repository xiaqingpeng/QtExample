cmake_minimum_required(VERSION 3.16)

# 项目信息
project("QT Example" VERSION 1.0.0 LANGUAGES CXX)

# 设置C++标准
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_AUTOUIC ON)
set(CMAKE_AUTOMOC ON)
set(CMAKE_AUTORCC ON)

# 查找Qt模块 - 轻量级版本，只使用基础模块
find_package(Qt6 COMPONENTS Core Gui Widgets Network REQUIRED)

# 设置MacOS特定选项
if(APPLE)
    set(CMAKE_OSX_DEPLOYMENT_TARGET "10.15" CACHE STRING "Minimum macOS version" FORCE)
    set(MACOSX_BUNDLE_BUNDLE_NAME "QT Example")
    set(MACOSX_BUNDLE_BUNDLE_VERSION ${PROJECT_VERSION})
    set(MACOSX_BUNDLE_SHORT_VERSION_STRING ${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR})
    set(MACOSX_BUNDLE_GUI_IDENTIFIER "com.example.qtexample")
    set(MACOSX_BUNDLE_ICON_FILE "icon")
endif()

# NetworkManager模块 - 简化版
qt_add_library(NetworkManager STATIC
    networkmanager.cpp
    networkmanager.h
)
target_link_libraries(NetworkManager PRIVATE
    Qt6::Core
    Qt6::Network
)

# BasicControls模块
qt_add_library(BasicControls STATIC
    basiccontrols/basiccontrolstab.cpp
    basiccontrols/basiccontrolstab.h
)
target_link_libraries(BasicControls PRIVATE
    Qt6::Core
    Qt6::Gui
    Qt6::Widgets
)

# DataDisplay模块
qt_add_library(DataDisplay STATIC
    datadisplay/datadisplaytab.cpp
    datadisplay/datadisplaytab.h
)
target_link_libraries(DataDisplay PRIVATE
    Qt6::Core
    Qt6::Gui
    Qt6::Widgets
)

# 主应用程序源文件
set(SOURCES
    main.cpp
    mainuiwindow.cpp
)

set(HEADERS
    mainuiwindow.h
)

set(UIS
    mainuiwindow.ui
)

# 创建可执行文件
qt_add_executable(QTExample MACOSX_BUNDLE ${SOURCES} ${HEADERS} ${UIS})

# 设置应用程序显示名称和输出名称
set_target_properties(QTExample PROPERTIES
    OUTPUT_NAME "example"
    MACOSX_BUNDLE_BUNDLE_NAME "QT Example"
)

# 设置应用程序图标
if(APPLE)
    set(ICON_FILE "${CMAKE_CURRENT_SOURCE_DIR}/images/icon.png")
    if(EXISTS ${ICON_FILE})
        set_source_files_properties(${ICON_FILE} PROPERTIES MACOSX_PACKAGE_LOCATION "Resources")
        target_sources(QTExample PRIVATE ${ICON_FILE})
    endif()
endif()

# 设置RPATH
set_target_properties(QTExample PROPERTIES
    MACOSX_RPATH YES
    BUILD_WITH_INSTALL_RPATH YES
    INSTALL_RPATH @executable_path/../Frameworks
)

# 链接Qt库和自定义模块 - 轻量级版本
target_link_libraries(QTExample PRIVATE
    Qt6::Core
    Qt6::Gui
    Qt6::Widgets
    Qt6::Network
    NetworkManager
    BasicControls
    DataDisplay
)

# 包含模块头文件目录
target_include_directories(QTExample PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CMAKE_CURRENT_SOURCE_DIR}/basiccontrols
    ${CMAKE_CURRENT_SOURCE_DIR}/datadisplay
)

# 安装规则
install(TARGETS QTExample
    BUNDLE DESTINATION .
    LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
    RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
)