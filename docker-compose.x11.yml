# Docker Compose 配置 - Qt Example 项目（X11 图形界面模式）
# 需要先安装和配置 XQuartz

services:
  # Qt Linux 桌面开发环境（X11 模式）
  qt-dev:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # 如果遇到 ports.ubuntu.com 502/超时（特别是 ARM64），使用国内镜像源：
        UBUNTU_MIRROR: "https://mirrors.tuna.tsinghua.edu.cn"
    container_name: qt-example-linux-dev-x11
    volumes:
      - .:/workspace                           # 挂载当前项目目录（包含 build 目录）
    # 注意: macOS 上不能直接挂载 /tmp/.X11-unix，需要使用网络连接
    # volumes:
    #   - /tmp/.X11-unix:/tmp/.X11-unix:rw     # Linux 上可以这样，但 macOS 不行
    environment:
      - DISPLAY=host.docker.internal:0         # macOS 上通过 XQuartz 显示
      - QT_QPA_PLATFORM=xcb                    # 使用 XCB 平台插件
      - XDG_RUNTIME_DIR=/tmp/runtime-root      # 设置运行时目录，避免警告
    working_dir: /workspace
    # 默认构建命令：CMake 风格，构建完成后保持容器运行
    command: >
      /bin/bash -c "mkdir -p build &&
                    cd build &&
                    cmake .. &&
                    make -j\$(nproc) &&
                    tail -f /dev/null"
    network_mode: bridge

