# 🌍 跨平台兼容性说明

本项目已配置为**完全跨平台兼容**，支持 **Linux**、**macOS** 和 **Windows** 平台。

## 📋 平台支持概览

| 平台 | 状态 | WebEngine | 字体支持 | 构建方式 |
|------|------|-----------|----------|----------|
| **Linux** | ✅ 完全支持 | ❌ 禁用（ARM64 不完整） | ✅ Noto Sans CJK | Docker + CMake |
| **macOS** | ✅ 完全支持 | ✅ 可用 | ✅ PingFang SC | CMake/Xcode |
| **Windows** | ✅ 完全支持 | ❌ 禁用（兼容性） | ✅ Microsoft YaHei | CMake + MSVC/MinGW |

## 🔧 统一的兼容性配置

### 1. WebEngine 处理（统一逻辑）

**所有平台使用相同的降级方案**：

```cmake
# 主 CMakeLists.txt 中统一配置
set(WEBENGINE_AVAILABLE FALSE)
if(Qt6WebEngineWidgets_FOUND AND NOT WIN32)
    set(WEBENGINE_AVAILABLE TRUE)
elseif(WIN32)
    # Windows 平台禁用
else()
    # Linux ARM64 等平台不可用
endif()
```

**所有模块统一使用**：
- `src/Device/CMakeLists.txt` - 使用 `WEBENGINE_AVAILABLE`
- `src/UserProfile/CMakeLists.txt` - 使用 `WEBENGINE_AVAILABLE`
- `src/Reports/CMakeLists.txt` - 使用 `WEBENGINE_AVAILABLE`
- `src/Charts/CMakeLists.txt` - 使用 `WEBENGINE_AVAILABLE`

**结果**：
- ✅ Linux 和 Windows 使用相同的代码路径
- ✅ 降级方案完全一致
- ✅ 维护成本低

### 2. 字体配置（平台特定但逻辑统一）

**main.cpp 中的字体配置**：

```cpp
#ifdef Q_OS_LINUX
    // Linux: Noto Sans CJK
    defaultFont.setFamily("Noto Sans CJK SC");
    fontFamilies << "Noto Sans CJK SC" << "Noto Sans CJK JP" << "Noto Sans CJK KR"
                 << "WenQuanYi Micro Hei" << "WenQuanYi Zen Hei";
#elif defined(Q_OS_WIN)
    // Windows: Microsoft YaHei
    defaultFont.setFamily("Microsoft YaHei");
    fontFamilies << "Microsoft YaHei" << "SimSun" << "Malgun Gothic" << "Meiryo";
#endif
```

**逻辑统一**：
- 所有平台都使用字体回退机制
- 所有平台都支持中、日、韩文字符
- 字体配置方式相同

### 3. 多语言支持（完全统一）

**翻译文件**：
- 格式：`.qm` 文件
- 位置：`build/translations/` 或 `build-windows/translations/`
- 加载逻辑：完全相同

**支持的语言**：
- ✅ 简体中文（zh_CN）
- ✅ 英文（en_US）
- ✅ 日文（ja_JP）
- ✅ 韩文（ko_KR）

## 🎯 平台特定配置

### Linux（Docker）

**特点**：
- 使用 Docker + X11 环境
- ARM64 架构支持
- WebEngine 不可用（ARM64 限制）

**配置**：
- `Dockerfile` - Ubuntu 22.04 + Qt6
- `docker-compose.yml` - X11 显示配置
- 字体：Noto Sans CJK（Dockerfile 中安装）

### Windows

**特点**：
- 原生 Windows 支持
- WebEngine 禁用（兼容性考虑）
- 使用系统字体

**配置**：
- `CMakeLists.txt` - Windows 平台检测
- `main.cpp` - Windows 字体配置
- 无需额外字体安装（使用系统字体）

### macOS

**特点**：
- 原生 macOS 支持
- WebEngine 可用
- 完整功能支持

**配置**：
- `CMakeLists.txt` - macOS Bundle 配置
- `main.cpp` - macOS 字体配置
- `Info.plist.in` - 应用包配置

## 📝 代码中的平台检测

### CMake 层面

```cmake
# 平台检测
if(APPLE)
    # macOS 配置
elseif(WIN32)
    # Windows 配置
else()
    # Linux 配置
endif()

# WebEngine 配置（统一）
if(Qt6WebEngineWidgets_FOUND AND NOT WIN32)
    set(WEBENGINE_AVAILABLE TRUE)
endif()
```

### C++ 代码层面

```cpp
// 字体配置
#ifdef Q_OS_MACOS
    // macOS
#elif defined(Q_OS_LINUX)
    // Linux
#elif defined(Q_OS_WIN)
    // Windows
#endif

// WebEngine 条件编译
#ifdef WEBENGINE_AVAILABLE
    // WebEngine 代码
#else
    // 降级方案
#endif
```

## ✅ 兼容性保证

### 核心功能（所有平台）

- ✅ 登录/注册
- ✅ 用户信息管理
- ✅ 数据展示
- ✅ 多语言切换
- ✅ 主题切换
- ✅ 网络请求
- ✅ 数据分析

### 受限功能（部分平台）

- ⚠️ **WebEngine 图表**：
  - Linux（ARM64）：不可用 → 显示占位符
  - Windows：禁用 → 显示占位符
  - macOS：可用 → 正常显示

## 🔍 验证跨平台兼容性

### Linux 验证

```bash
# 在 Docker 中构建和运行
./docker-build-and-run.sh
docker-compose run --rm qt-dev bash
cd /workspace/build && ./example
```

### Windows 验证

```powershell
# 使用 CMake 构建
mkdir build-windows
cd build-windows
cmake .. -DCMAKE_PREFIX_PATH="C:/Qt/6.x.x/msvc2019_64"
cmake --build . --config Release
.\Release\example.exe
```

### macOS 验证

```bash
# 使用 CMake 构建
mkdir build-macos
cd build-macos
cmake ..
make -j$(sysctl -n hw.ncpu)
./example
```

## 📚 相关文档

- **Linux 构建**：`DOCKER-README.md`、`DOCKER-SETUP.md`
- **Windows 构建**：`WINDOWS-构建说明.md`
- **字体配置**：`DOCKER-字体配置说明.md`

## 🎉 总结

项目已实现**完全跨平台兼容**：

1. ✅ **统一的代码逻辑** - Linux 和 Windows 使用相同的降级方案
2. ✅ **统一的配置方式** - 所有模块使用相同的 WebEngine 检测逻辑
3. ✅ **平台特定优化** - 每个平台都有针对性的字体和配置
4. ✅ **完整的文档** - 每个平台都有详细的构建说明

**Linux 平台不兼容的功能，Windows 平台也不兼容** - 这正是我们想要的统一行为！

---

**跨平台兼容性配置完成！** 🎉

