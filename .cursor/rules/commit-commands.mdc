---
description: 动态生成{language_type1}{language_type2} Git Commit 信息命令（基于实际代码变更）
globs: 
alwaysApply: true
---

# 动态 Commit 语言切换规则

## 语言类型配置

**可配置变量**（用户可以根据需要修改这些值）：
- `{language_type1}` = "中文"
- `{language_type2}` = "英文"

**使用说明**：以下所有出现 `{language_type1}` 和 `{language_type2}` 的地方，将自动替换为上述配置的值。

## AI 角色定位

你是一位经验丰富的软件工程师和高效的技术沟通者。你的任务是分析代码变更并生成准确、简洁的 commit 信息。

当用户在对话框中输入以下指令时，请严格按照本规则执行：

## 触发指令
- `commit {language_type1}`：生成{language_type1} commit 信息
- `commit {language_type2}`：生成{language_type2} commit 信息

## 核心原则

1. **基于实际代码变更**：commit 信息必须基于**实际代码变更内容**生成，而不是仅根据文件名猜测。
2. **关注具体变更**：专注于具体的代码改动，避免泛泛而谈。描述要具体到修改了什么功能、添加了什么代码、修复了什么问题。
3. **隐私保护**：
   - **不要输出**姓名、邮箱地址或其他个人身份信息（除非在代码变更中明确存在且是必要的）
   - **不要输出**bug ID、issue ID、ticket ID 或其他唯一标识符（除非在代码变更中明确存在且是必要的）
4. **简洁准确**：commit 信息要简洁明了，准确反映代码的实际变更内容，不超过 60 字符。

## 执行步骤

1.  **检查暂存区和工作区**：
    - 执行 `git status --short` 检查暂存区和工作区的状态。
    - **如果暂存区有文件**（第一列有 A/M/D/R 等标记），直接进入下一步。
    - **如果暂存区为空**，检查工作区是否有未暂存的变更：
      - 如果工作区有修改的文件（第二列有 M/D 标记）或未跟踪的文件（?? 标记），**自动执行 `git add`** 暂存这些文件。
      - 使用直接文件路径而不是目录路径，避免卡住（例如：`git add "file1" "file2"`）。
      - 暂存完成后，重新执行 `git status --short` 确认文件已暂存。

2.  **获取实际代码变更内容**（关键步骤）：
    - **必须执行** `git --no-pager diff --cached` 获取暂存区的**完整代码变更内容**。
    - **重要**：使用 `--no-pager` 选项避免分页器阻塞，确保命令直接输出所有内容。
    - 这是生成准确 commit 信息的基础，不能跳过。
    - 仔细阅读代码变更，**专注于具体的改动**，理解：
      - **具体**修改了什么功能？（例如：添加了用户登录验证逻辑，而不是"更新了代码"）
      - **具体**添加了什么新代码？（例如：新增了 token 过期检查函数，而不是"添加了代码"）
      - **具体**删除了什么代码？（例如：移除了过时的 API 调用，而不是"删除了代码"）
      - **具体**修复了什么问题？（例如：修复了登录后页面跳转失败的问题，原因是缺少 await，而不是"修复了 bug"）
      - **具体**重构了什么逻辑？（例如：将用户认证逻辑提取到独立模块，而不是"重构了代码"）
    - **注意**：如果代码变更中包含个人信息或唯一标识符，不要在 commit 信息中输出。

3.  **分析代码变更**：
    - 基于实际的代码变更内容，判断变更类型：
      - 新增功能代码 → `feat`
      - 修复 bug 的代码 → `fix`
      - 文档/注释变更 → `docs`
      - 代码格式调整 → `style`
      - 代码重构 → `refactor`
      - 性能优化 → `perf`
      - 测试代码 → `test`
      - 构建/配置文件 → `chore`
    - 提取变更的**核心内容**，作为 commit 信息的描述。
    - **避免模糊描述**：不要使用"更新代码"、"修改文件"、"优化代码"等泛泛而谈的描述。
    - **使用具体描述**：例如"修复登录跳转失败"、"添加 token 过期检查"、"重构用户认证模块"等。

4.  **生成 commit message**：
    - **格式**：多行格式，包含简洁的 subject 和详细的主要变更
      ```
      <type>(<scope>): <subject>
      
      - <主要变更1>
      - <主要变更2>
      - <主要变更3>
      ```
    - **语言要求**：
      - `commit {language_type1}` → subject 和主要变更都使用**{language_type1}**
      - `commit {language_type2}` → subject 和主要变更都使用**{language_type2}**
    - **准确描述**：commit 信息必须准确反映代码变更的实际内容
    - **subject 要求**：简洁明了，不超过 60 字符，概括主要变更点
    - **主要变更要求**：基于 git diff 的实际内容，列出具体的变更点，每个变更点一行，使用 `- ` 开头

5.  **输出结果并询问确认**：

    ---
    
    **📋 暂存区变更信息：**
    
    变更文件：
    - <文件1> (状态)
    - <文件2> (状态)
    
    **主要变更内容：**
    <简要说明代码的主要变更，基于 git diff 的实际内容>
    
    变更摘要：新增 X 个 | 修改 Y 个 | 删除 Z 个
    
    ---
    
    **📝 生成的 Commit Message：**
    
    ```
    <type>(<scope>): <subject>
    
    - <主要变更1>
    - <主要变更2>
    - <主要变更3>
    ```
    
    ---
    
    **💻 提交命令（跨平台）：**
    
    **Windows PowerShell（避免乱码）:**
    ```powershell
    $msg = "<完整的 commit message>"; $bytes = [System.Text.Encoding]::UTF8.GetBytes($msg); [System.IO.File]::WriteAllBytes("$env:TEMP\commit-msg.txt", $bytes); git commit -F "$env:TEMP\commit-msg.txt"
    ```
    
    **Mac/Linux/Git Bash:**
    ```bash
    git commit -m "<完整的 commit message>"
    ```
    
    ---
    
    **❓ 确认提交：**
    
    是否需要执行此 commit？回复'好的'、'可以'、'yes'等即可执行。
    
    ---

6.  **执行确认**：
    - 如果用户回复以下任一确认词，则**立即执行** `git commit` 命令：
      - {language_type1}确认词：好的、可以、可以的、行、没问题、执行、提交、确认
      - {language_type2}确认词：yes、y、ok、okay、sure、go、execute、commit
    - 如果用户回复否定词（不、no、取消等），则不执行，并询问是否需要修改。
    
    **执行时使用跨平台编码处理**：
    - **Windows PowerShell**: 使用 UTF-8 无 BOM 文件方式
      ```powershell
      $msg = "<commit message>"; $bytes = [System.Text.Encoding]::UTF8.GetBytes($msg); [System.IO.File]::WriteAllBytes("$env:TEMP\commit-msg.txt", $bytes); git commit -F "$env:TEMP\commit-msg.txt"
      ```
    - **Mac/Linux/Git Bash**: 直接使用 `git commit -m`

7.  **提交后验证**：
    - 执行 `git log -1 --oneline` 验证 commit message 是否正确显示
    - 如果发现乱码，提示用户检查终端编码设置

## 重要提示

- **必须读取实际代码变更**：不能仅根据文件名猜测 commit 信息
- **关注具体变更**：专注于具体的代码改动，避免使用模糊的描述
- **commit 信息要有意义**：准确描述代码的实际变更内容，让其他开发者能快速理解改了什么
- **隐私保护**：不要在 commit 信息中包含个人信息或唯一标识符（除非代码变更中明确存在且必要）
- **避免分页器阻塞**：所有 git diff 命令必须使用 `--no-pager` 选项
  - ✅ 正确：`git --no-pager diff --cached`
  - ❌ 错误：`git diff --cached`（会触发分页器，需要手动按键翻页）
- **如果输出过长**：可以先用 `git --no-pager diff --cached --stat` 查看统计，或分批处理文件

## 示例交互

**用户**: `commit {language_type1}`

**AI**: 
（执行 git status --short 检查暂存文件）
（执行 git --no-pager diff --cached 获取完整代码变更）

---

**📋 暂存区变更信息：**

变更文件：
- src/pages/Login.vue (修改)
- src/utils/auth.ts (修改)

**主要变更内容：**
- 在 Login.vue 中修复了登录成功后 router.push 跳转失败的问题，原因是缺少 await
- 在 auth.ts 中添加了 token 过期时间的检查逻辑

变更摘要：新增 0 个 | 修改 2 个 | 删除 0 个

---

**📝 生成的 Commit Message：**

```
fix(auth): 修复登录成功后页面跳转失败的问题

- 在 Login.vue 中修复了登录成功后 router.push 跳转失败的问题，原因是缺少 await
- 在 auth.ts 中添加了 token 过期时间的检查逻辑
```

---

**💻 提交命令（跨平台）：**

**Windows PowerShell（避免乱码）:**
```powershell
$msg = "fix(auth): 修复登录成功后页面跳转失败的问题"; $bytes = [System.Text.Encoding]::UTF8.GetBytes($msg); [System.IO.File]::WriteAllBytes("$env:TEMP\commit-msg.txt", $bytes); git commit -F "$env:TEMP\commit-msg.txt"
```

**Mac/Linux/Git Bash:**
```bash
git commit -m "fix(auth): 修复登录成功后页面跳转失败的问题"
```

---

**❓ 确认提交：**

是否需要执行此 commit？回复'好的'、'可以'、'yes'等即可执行。

---

**用户**: `好的`

**AI**:
正在执行 commit...

✓ Commit 已成功执行！

验证结果：
```
abc1234 fix(auth): 修复登录成功后页面跳转失败的问题
```
