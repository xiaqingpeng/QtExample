# Docker Compose 配置 - Qt Example 项目（Offscreen 模式）
# 用于在无图形界面环境下运行程序

services:
  # Qt Linux 桌面开发环境（Offscreen 模式）
  qt-dev:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # 如果遇到 ports.ubuntu.com 502/超时（特别是 ARM64），使用国内镜像源：
        UBUNTU_MIRROR: "https://mirrors.tuna.tsinghua.edu.cn"
    container_name: qt-example-linux-dev-offscreen
    volumes:
      - .:/workspace                           # 挂载当前项目目录（包含 build 目录）
    environment:
      - QT_QPA_PLATFORM=offscreen              # 使用 offscreen 模式，无需 X11
      - XDG_RUNTIME_DIR=/tmp/runtime-root      # 设置运行时目录
    working_dir: /workspace
    # 默认构建命令：CMake 风格
    command: >
      /bin/bash -c "mkdir -p build &&
                    cd build &&
                    cmake .. &&
                    make -j\$(nproc)"
    network_mode: bridge

